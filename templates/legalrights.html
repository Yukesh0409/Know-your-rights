{% extends "index.html"%}
{% block title %}KnowYourRights - LegalRights{% endblock %}
{% block content %}
<style>
    table {
        border-collapse: collapse;
        width: 100%;
    }

    th, td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
    }

    th {
        background-color: #f2f2f2;
    }

    tr:nth-child(even) {
        background-color: #f2f2f2;
    }

    tr:hover {
        background-color: #ddd;
    }
    #btn-back-to-top {
  position: fixed;
  bottom: 20px;
  right: 20px;
  display: none;
}
</style>
<div>
    <label for="right-type">Filter by RIGHT Type:</label>
    <select id="right-type">
        <option value="">All</option>
        
        {% for right , data in grouped_data.items() %}
            <option value="{{ right }}">{{ right }}</option>
        {% endfor %}
    </select>
    <button id="filter-button">Search</button>
</div>

<div id="filtered-data">
    <table>
        <thead>
            <tr>
                <th>Article</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>
<button
        type="button"
        class="btn btn-danger btn-floating btn-lg"
        id="btn-back-to-top"
        >
  <i class="fas fa-arrow-up"></i>
</button>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        // Function to update the filtered data
        function updateFilteredData(selectedRight) {
            $.ajax({
                type: "GET",
                url: "/search",
                data: { query: selectedRight },
                success: function (data) {
                    var tableBody = $("#filtered-data tbody");
                    tableBody.empty();
                    var currentRight = "";

                    for (var i = 0; i < data.length; i++) {
                        for (var j = 0; j < data[i].LIST_OF_ARTICLES.length; j++) {
                            var article = data[i].LIST_OF_ARTICLES[j];
                            var description = data[i].DESCRIPTION[j];

                            // If the current "Right" is different from the previous one, create a new header row
                            if (data[i].RIGHTS !== currentRight) {
                                var headerRow = "<tr><th colspan='2'><center>" + data[i].RIGHTS + "</center></th></tr>";
                                tableBody.append(headerRow);
                                currentRight = data[i].RIGHTS;
                            }

                            var row = "<tr><td>" + article + "</td><td>" + description + "</td></tr>";
                            tableBody.append(row);
                        }
                    }
                },
            });
        }

        updateFilteredData("");

        $("#filter-button").click(function () {
            var selectedRight = $("#right-type").val();
            updateFilteredData(selectedRight);
        });
    });
    //Get the button
let mybutton = document.getElementById("btn-back-to-top");

// When the user scrolls down 20px from the top of the document, show the button
window.onscroll = function () {
  scrollFunction();
};

function scrollFunction() {
  if (
    document.body.scrollTop > 20 ||
    document.documentElement.scrollTop > 20
  ) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}
// When the user clicks on the button, scroll to the top of the document
mybutton.addEventListener("click", backToTop);

function backToTop() {
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
}
</script>
{% endblock %}